ADBSCAN on AAEON Robot Kit
=====================================

This tutorial describes how to run the ADBSCAN algorithm on the real robot `UP Xtreme i11 AAEON Robot Kit <https://up-shop.org/up-xtreme-i11-robotic-kit.html>`__ using the |realsense| camera input.
During the execution of the program the ADBSCAN algorithm detects objects, and draws them in rviz. Then, the FastMapping algorithm uses data from the ADBSCAN to generate a 2D Map of the environment around.
User can use the default setup to move robot via gamepad or keyboard, so the 3D-camera on the robot can scan surroundings around.

Prerequisites:

- Assemble your robotic kit following the instructions provided by AAEON.

- Ensure the :doc:`system is set up correctly <../../../../gsg_robot/prepare-system>`.

- To control the robot remotely, you may need a Logitech* F710 gamepad (to be purchased separately).


Run the ADBSCAN Algorithm Using the AAEON Robot Kit
---------------------------------------------------------


#. To download and install the tutorial run the command below:

   .. code-block:: bash

      sudo apt-get install ros-humble-aaeon-adbscan-tutorial-common
      sudo apt-get install ros-humble-aaeon-adbscan-tutorial

#. Please perform IMU calibration of the robot, launch script below:

   .. code-block:: bash

      source /opt/ros/humble/setup.bash
      /opt/ros/humble/share/ros2_amr_interface/scripts/calibration.sh

#. Place the robot in front of an object and use one of the two methods
   described below to control the robot:

   .. image:: ../../../../images/adbscan_aaeon_object_s.png
      :width: 600

Gamepad Robot Control Method
---------------------------------------------------------


#. Launch the ADBSCAN AAEON Robot gamepad control program:

   .. code-block:: bash

      sudo chmod a+rw /dev/input/js0
      sudo chmod a+rw /dev/input/event*

   .. code-block:: bash

      source /opt/ros/humble/setup.bash
      /opt/ros/humble/share/aaeon_adbscan/tutorial-aaeon-adbscan/aaeon_robot_with_adbscan_realsense_gamepad.sh


#. Move the robot around using the gamepad:

   .. image:: ../../../../images/gamepad_Logitech_F710_v2.png
      :width: 600

   -  Hold the **RB** button, then press the **Mode** button on the joystick.

   -  The green LED near this button should illuminate.

   -  Use the **D-pad** to control the robot's movement.

   .. image:: ../../../../images/adbscan_aaeon_gamepad_control.gif
      :width: 600

Keyboard Robot Control Method
---------------------------------------------------------


#. Launch the ADBSCAN AAEON Robot keyboard control program:

   .. code-block:: bash

      source /opt/ros/humble/setup.bash
      /opt/ros/humble/share/aaeon_adbscan/tutorial-aaeon-adbscan/aaeon_robot_with_adbscan_realsense_keyboard.sh

#. In a separate Terminal window launch keyboard control handler:

   .. code-block:: bash

      source /opt/ros/humble/setup.bash
      ros2 run teleop_twist_keyboard teleop_twist_keyboard

   The robot responds to your keyboard commands in these ways:

   -  **i**: Move forward

   -  **k**: Stop

   -  **,**: Move backward

   -  **j**: Turn right

   -  **l**: Turn left

   -  **q/z**: Increase/decrease max speeds by 10%

   -  **w/x**: Increase/decrease only linear speed by 10%

   -  **e/c**: Increase/decrease only angular speed by 10%

   -  **L** or **J** (only for omnidirectional robots): Strafe (move sideways)

   -  anything else: Stop

   -  ``Ctrl-c``: Quit


#. Move the robot around using the keyboard buttons:

   .. image:: ../../../../images/adbscan_aaeon_keyboard_control.gif
      :width: 600


   .. note::

      To keep keyboard controls working keep second terminal window above other windows. 

   .. image:: ../../../../images/adbscan_aaeon_pic4.png
      :width: 600


Expected Results
---------------------------------------------------------


#. On the server rviz, you will see how ADBSCAN interprets
   the |realsense| data based on real objects around the robot:

   -  Green blocks indicate objects around.
           .. image:: ../../../../images/adbscan_aaeon_pic1.png
              :width: 800


   -  Turn off MarkerArray in rviz to see a 2D Map generated by FastMapping.
           .. image:: ../../../../images/adbscan_aaeon_pic2.png
              :width: 800


#. Default ADBSCAN view in the rviz window:

   .. image:: ../../../../images/adbscan_aaeon_3d_map.gif
      :width: 800


#. Enable FastMapping 2D map view by turning off MakerArray check-box:

   .. image:: ../../../../images/adbscan_aaeon_2d_map.gif
      :width: 800


Troubleshooting
----------------------------

For general robot issues, go to: :doc:`../../../../dev_guide/tutorials_amr/robot-tutorials-troubleshooting`.
